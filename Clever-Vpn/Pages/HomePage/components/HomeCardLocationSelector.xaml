<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="Clever_Vpn.Pages.HomePage.components.HomeCardLocationSelector"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Clever_Vpn.Pages.HomePage.components"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:utils="using:Clever_Vpn.utils"
    xmlns:vpn="using:Clever_Vpn_Windows_Kit.Data"
    mc:Ignorable="d">

    <Grid HorizontalAlignment="Center">
        <Button  Background="Transparent" BorderThickness="0" Click="OpenDlg">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="8">
                <Image x:Name="FlagImage"
               Width="20"
               Height="20"
               Source="{x:Bind GetFlag(Vm.UserInfo), Mode=OneWay}"
               Stretch="Uniform"/>
                <TextBlock Text="{x:Bind GetLocationName(Vm.UserInfo), Mode=OneWay}" />
                <FontIcon Glyph="&#xE70F;" Foreground="DeepSkyBlue" FontSize="14"/>
            </StackPanel>
        </Button>
        <ContentDialog x:Name="MyDlg">
            <Grid >
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <ListView
                    x:Name="AddressListView"
                    IsItemClickEnabled="True"
                    ItemClick="OnItemClick"
                    SelectionMode="None">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="vpn:Location">
                            <Grid Padding="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <Image
                               Width="20"
                               Height="20"
                               Source="{x:Bind local:HomeCardLocationSelector.GetFlagFromCode(Code), Mode=OneWay}"
                               Stretch="Uniform" Margin="0, 0, 20, 0"/>

                                <TextBlock                            
                                Grid.Column="1"
                                Text="{Binding Label}" />

                                <!-- Check icon if selected -->
                                <FontIcon 
                                Glyph="&#xE73E;"
                                Foreground="DeepSkyBlue"
                                Visibility="{x:Bind local:HomeCardLocationSelector.ShowSelected(Id), Mode=OneWay}"
                                Grid.Column="2" />
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

                <Grid Grid.Row="1" HorizontalAlignment="Stretch" BorderThickness="0,1,0,0" BorderBrush="LightGray" Margin="0,10,0,0">
                    <StackPanel Grid.Row="1" 
                        Padding="0,10,0,0"
                        Orientation="Horizontal" 
                        HorizontalAlignment="Right" 
                        VerticalAlignment="Center"
                        Spacing="20">
                        <Button
                            Click="OnUpdateClick"
                        >
                            <Grid >
                                <TextBlock x:Name="UpdateButtonText" >Update</TextBlock>
                                <ProgressRing x:Name="UpdateButtonLoading" Height="22" Width="22" IsActive="True" Visibility="Collapsed"/>
                            </Grid>
                        </Button>
                        <Button Content="Cancel"
                      Click="OnCancelClick" />
                    </StackPanel>
                </Grid>
            </Grid>
        </ContentDialog>
    </Grid>

</UserControl>
